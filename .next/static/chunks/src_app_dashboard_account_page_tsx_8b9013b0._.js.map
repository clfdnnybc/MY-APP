{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/57block/my-app/src/app/dashboard/account/page.tsx"],"sourcesContent":["\"use client\";\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useUsername } from \"../../UsernameContext\";\n\nexport default function AccountPage() {\n  const { username, setUsername } = useUsername();\n  const [showUsernameForm, setShowUsernameForm] = useState(false);\n  const [showPasswordForm, setShowPasswordForm] = useState(false);\n  const [newUsername, setNewUsername] = useState(\"\");\n  const [oldPassword, setOldPassword] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const router = useRouter();\n\n \n\n  // Helper function to close both forms\n  const closeAllForms = () => {\n    setShowUsernameForm(false);\n    setShowPasswordForm(false);\n  };\n\n  // Handle form input changes\n  const handleChange = (e: any) => {\n    const { name, value } = e.target;\n    switch (name) {\n      case \"newUsername\":\n        setNewUsername(value);\n        break;\n      case \"oldPassword\":\n        setOldPassword(value);\n        break;\n      case \"newPassword\":\n        setNewPassword(value);\n        break;\n      default:\n        break;\n    }\n  };\n\n  // Handle username update submission\n  const handleUsernameSubmit = async (e: React.FormEvent) => {\n  e.preventDefault();\n  setIsSubmitting(true);\n  setMessage(\"\");\n\n  try {\n    const res = await fetch(\"/api/account/username\", {\n      method: \"PUT\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        username: newUsername,\n        storedUsername: username, // 发送当前用户名\n      }),\n    });\n    const json = await res.json();\n    if (!res.ok) throw new Error(json.message);\n\n    setMessage(json.message);\n    // Update the local username state and localStorage\n    setUsername(newUsername);\n    localStorage.setItem(\"username\", newUsername);\n    closeAllForms(); // Close all forms after successful update\n    } catch (err:any) {\n    setMessage(err.message);\n    } finally {\n    setIsSubmitting(false);\n    }\n    };\n\n    // Handle password update submission\n    const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setMessage(\"\");\n\n    try {\n        const res = await fetch(\"/api/account/password\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n            oldPassword,\n            newPassword,\n            storedUsername: username, // 发送当前用户名\n        }),\n        });\n        const json = await res.json();\n        if (!res.ok) throw new Error(json.message);\n\n        setMessage(json.message);\n        closeAllForms(); // Close all forms after successful update\n    } catch (err:any) {\n        setMessage(err.message);\n    } finally {\n        setIsSubmitting(false);\n    }\n    };\n  return (\n    <div className=\"bg-white dark:bg-gray-900 dark:text-white p-8 rounded-lg shadow-md w-full max-w-md mx-auto\">\n      <h1 className=\"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6\">Account Settings</h1>\n\n      <div className=\"mb-6 text-center\">\n        <img src=\"/avatar.ico\" alt=\"avatar\" className=\"w-32 h-32 rounded-full mx-auto\" />\n        <p className=\"text-gray-700 dark:text-gray-200 text-center mt-2\">{username}</p>\n      </div>\n\n      {/* Username Update Section */}\n      <div className=\"space-y-4\">\n        <div className=\"flex justify-between items-center\">\n          <h2 className=\"text-lg font-medium text-gray-700 dark:text-gray-100\">Username</h2>\n          <button\n            onClick={() => {\n              setShowUsernameForm(!showUsernameForm);\n              if (!showUsernameForm) setNewUsername(username); \n            }}\n            className=\"text-blue-500 font-medium hover:underline\"\n          >\n            {showUsernameForm ? \"Cancel\" : \"Edit\"}\n          </button>\n        </div>\n\n        {showUsernameForm ? (\n          <form onSubmit={handleUsernameSubmit} className=\"space-y-2\">\n            <input\n              type=\"text\"\n              name=\"newUsername\"\n              value={newUsername}\n              onChange={handleChange}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n            />\n            <button\n              className={`px-6 py-2 rounded-lg ${\n                isSubmitting ? \"bg-gray-400 cursor-not-allowed\" : \"bg-blue-500 hover:bg-blue-600\"\n              } text-white w-full`}\n              type=\"submit\"\n              disabled={isSubmitting}\n              onClick={() => localStorage.setItem(\"username\", newUsername)} // Update localStorage on submit\n            >\n              {isSubmitting ? \"Processing...\" : \"Update Username\"}\n            </button>\n          </form>\n        ) : (\n          <p className=\"text-gray-600 dark:text-gray-400\">Click \"Edit\" to change your username.</p>\n        )}\n      </div>\n\n      {/* Password Update Section */}\n      <div className=\"space-y-4\">\n        <div className=\"flex justify-between items-center\">\n          <h2 className=\"text-lg font-medium text-gray-700 dark:text-gray-100\">Password</h2>\n          <button\n            onClick={() => setShowPasswordForm(!showPasswordForm)}\n            className=\"text-blue-500 font-medium hover:underline\"\n          >\n            {showPasswordForm ? \"Cancel\" : \"Edit\"}\n          </button>\n        </div>\n\n        {showPasswordForm ? (\n          <form onSubmit={handlePasswordSubmit} className=\"space-y-2\">\n            <input\n              type=\"password\"\n              name=\"oldPassword\"\n              value={oldPassword}\n              onChange={handleChange}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n              placeholder=\"Current Password\"\n            />\n            <input\n              type=\"password\"\n              name=\"newPassword\"\n              value={newPassword}\n              onChange={handleChange}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n              placeholder=\"New Password\"\n            />\n            <button\n              className={`px-6 py-2 rounded-lg ${\n                isSubmitting ? \"bg-gray-400 cursor-not-allowed\" : \"bg-blue-500 hover:bg-blue-600\"\n              } text-white w-full`}\n              type=\"submit\"\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? \"Processing...\" : \"Update Password\"}\n            </button>\n          </form>\n        ) : (\n          <p className=\"text-gray-600 dark:text-gray-400\">Click \"Edit\" to change your password.</p>\n        )}\n      </div>\n\n      {message && (\n        <div className=\"mt-6 p-4 bg-blue-100 border border-blue-100 rounded-lg text-blue-800\">\n          {message}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}