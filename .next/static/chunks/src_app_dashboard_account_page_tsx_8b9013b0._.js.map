{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/57block/my-app/src/app/dashboard/account/page.tsx"],"sourcesContent":["\"use client\";\nimport { useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useUsername } from \"../../UsernameContext\";\nimport { useTranslation } from \"react-i18next\"; \n\n\nexport default function AccountPage() {\n  const { username, setUsername } = useUsername();\n  const [showUsernameForm, setShowUsernameForm] = useState(false);\n  const [showPasswordForm, setShowPasswordForm] = useState(false);\n  const [newUsername, setNewUsername] = useState(\"\");\n  const [oldPassword, setOldPassword] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const router = useRouter();\n  const { t } = useTranslation(); // 新增\n\n  const closeAllForms = () => {\n    setShowUsernameForm(false);\n    setShowPasswordForm(false);\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    switch (name) {\n      case \"newUsername\":\n        setNewUsername(value);\n        break;\n      case \"oldPassword\":\n        setOldPassword(value);\n        break;\n      case \"newPassword\":\n        setNewPassword(value);\n        break;\n      default:\n        break;\n    }\n  };\n\n  const handleUsernameSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setMessage(\"\");\n    try {\n      const res = await fetch(\"/api/account/username\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ username: newUsername, storedUsername: username }),\n      });\n      const json = await res.json();\n      if (!res.ok) throw new Error(json.message);\n      setMessage(json.message);\n      setUsername(newUsername);\n      localStorage.setItem(\"username\", newUsername);\n      closeAllForms();\n    } catch (err: any) {\n      setMessage(err.message);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const handlePasswordSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n    setMessage(\"\");\n    try {\n      const res = await fetch(\"/api/account/password\", {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ oldPassword, newPassword, storedUsername: username }),\n      });\n      const json = await res.json();\n      if (!res.ok) throw new Error(json.message);\n      setMessage(json.message);\n      closeAllForms();\n    } catch (err: any) {\n      setMessage(err.message);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const UpdateButton = ({\n    onClick,\n    text,\n  }: {\n    onClick: (e: React.FormEvent) => void | Promise<void>;\n    text: string;\n  }) => (\n    <button\n      onClick={onClick}\n      type=\"submit\"   \n      className={`w-full px-4 py-2 rounded-lg text-white transition-colors\n                  ${isSubmitting ? \"bg-gray-400 cursor-not-allowed\" : \"bg-blue-500 hover:bg-blue-600\"}`}\n      disabled={isSubmitting}\n    >\n      {text}\n    </button>\n  );\n\n  return (\n    <div className=\"bg-white dark:bg-gray-900 dark:text-white p-8 rounded-lg shadow-md w-full max-w-md mx-auto\">\n      <h1 className=\"text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-6\">{t(\"accountSettings\")}</h1>\n\n      <div className=\"mb-6 text-center\">\n        <img src=\"/avatar.ico\" alt=\"avatar\" className=\"w-32 h-32 rounded-full mx-auto\" />\n        <p className=\"text-gray-700 dark:text-gray-200 text-center mt-2\">{username}</p>\n      </div>\n\n      {/* Username Section */}\n      <div className=\"space-y-3\">\n        <div className=\"flex justify-between items-center\">\n          <h2 className=\"text-lg font-medium text-gray-700 dark:text-gray-100\">{t(\"username\")}</h2>\n          <button\n            onClick={() => {\n              if (!showUsernameForm) setNewUsername(username);\n              setShowUsernameForm(!showUsernameForm);\n            }}\n            className=\"px-3 py-1 text-sm rounded text-white bg-blue-500 hover:bg-blue-600\"\n          >\n            {showUsernameForm ? t(\"cancel\") : t(\"edit\")}\n          </button>\n        </div>\n\n        <div\n          className={`transition-[max-height,opacity] duration-300 ease-in-out overflow-hidden\n                      ${showUsernameForm ? \"max-h-40 opacity-100\" : \"max-h-0 opacity-0\"}`}\n        >\n          <form onSubmit={handleUsernameSubmit} className=\"space-y-2\">\n            <input\n              type=\"text\"\n              name=\"newUsername\"\n              value={newUsername}\n              onChange={handleChange}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n            />\n            <UpdateButton onClick={handleUsernameSubmit} text={t(\"updateUsername\")} />\n          </form>\n        </div>\n\n        {!showUsernameForm && (\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">{t(\"editUsernameTip\")}</p>\n        )}\n      </div>\n\n      {/* Password Section */}\n      <div className=\"space-y-3 mt-8\">\n        <div className=\"flex justify-between items-center\">\n          <h2 className=\"text-lg font-medium text-gray-700 dark:text-gray-100\">{t(\"password\")}</h2>\n          <button\n            onClick={() => setShowPasswordForm(!showPasswordForm)}\n            className=\"px-3 py-1 text-sm rounded text-white bg-blue-500 hover:bg-blue-600\"\n          >\n            {showPasswordForm ? t(\"cancel\") : t(\"edit\")}\n          </button>\n        </div>\n\n        <div\n          className={`transition-[max-height,opacity] duration-300 ease-in-out overflow-hidden\n                      ${showPasswordForm ? \"max-h-60 opacity-100\" : \"max-h-0 opacity-0\"}`}\n        >\n          <form onSubmit={handlePasswordSubmit} className=\"space-y-2\">\n            <input\n              type=\"password\"\n              name=\"oldPassword\"\n              value={oldPassword}\n              onChange={handleChange}\n              placeholder={t(\"currentPassword\")}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n            />\n            <input\n              type=\"password\"\n              name=\"newPassword\"\n              value={newPassword}\n              onChange={handleChange}\n              placeholder={t(\"newPassword\")}\n              className=\"w-full p-3 border rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500\"\n            />\n            <UpdateButton onClick={handlePasswordSubmit} text={t(\"updatePassword\")} />\n          </form>\n        </div>\n\n        {!showPasswordForm && (\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">{t(\"editPasswordTip\")}</p>\n        )}\n      </div>\n\n      {message && (\n        <div className=\"mt-6 p-4 bg-blue-100 border border-blue-100 rounded-lg text-blue-800\">\n          {message}\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}