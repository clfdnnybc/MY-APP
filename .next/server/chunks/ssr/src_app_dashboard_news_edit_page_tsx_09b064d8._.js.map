{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/57block/my-app/src/app/dashboard/news/edit/page.tsx"],"sourcesContent":["// app/dashboard/news/edit/page.tsx\n'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { useTranslation } from 'react-i18next';\nimport { useUsername } from '@/app/UsernameContext';\n\ninterface NewsForm {\n  title: string;\n  content: string;\n  date: string;\n  published: boolean;\n  username: string;\n  avatar: string;\n}\n\nexport default function NewsEditPage() {\n  const { t } = useTranslation();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const id = searchParams.get('id');            // 编辑模式\n  const [loading, setLoading] = useState(false);\n  const { username, avatar } = useUsername();\n  const [form, setForm] = useState<NewsForm>({\n    title: '',\n    content: '',\n    date: new Date().toISOString().split('T')[0],\n    published: true,\n    username,\n    avatar,\n  });\n\n  /* ---------- 编辑模式：拉取旧数据 ---------- */\n  useEffect(() => {\n    if (!id) return;\n    const fetchNews = async () => {\n      try {\n        const res = await fetch(`/api/news/${id}`);\n        if (!res.ok) throw new Error();\n        const data = await res.json();\n        setForm({\n          title: data.title || '',\n          content: data.content || '',\n          date:  new Date().toISOString().split('T')[0],\n          published: data.published || false,\n          username: username,\n          avatar: avatar,\n        });\n      } catch {\n        alert(t('fetchError'));\n        router.replace('/dashboard/news');\n      }\n    };\n    fetchNews();\n  }, [id, router, t]);\n\n  /* ---------- 表单提交 ---------- */\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n\n    const url = id ? `/api/news/${id}` : '/api/news';\n    const method = id ? 'PUT' : 'POST';\n\n    try {\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(form),\n      });\n      if (!res.ok) throw new Error();\n      router.replace('/dashboard');\n    } catch {\n      alert(t('saveError'));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  /* ---------- 渲染 ---------- */\n  return (\n    <div className=\"max-w-3xl mx-auto p-6 bg-white dark:bg-gray-800 rounded-md shadow-md\">\n      <h1 className=\"text-2xl font-bold mb-6\">\n        {id ? t('editNews') : t('addNews')}\n      </h1>\n\n      <form onSubmit={handleSubmit} className=\"space-y-6\">\n        {/* 标题 */}\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">{t('title')}</label>\n          <input\n            type=\"text\"\n            required\n            value={form.title}\n            onChange={(e) => setForm({ ...form, title: e.target.value })}\n            className=\"w-full border rounded p-2 focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        {/* 内容 */}\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">{t('content')}</label>\n          <textarea\n            required\n            rows={6}\n            value={form.content}\n            onChange={(e) => setForm({ ...form, content: e.target.value })}\n            className=\"w-full border rounded p-2 focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        {/* 日期 */}\n        <div>\n          <label className=\"block text-sm font-medium mb-1\">{t('date')}</label>\n          <input\n            type=\"date\"\n            required\n            value={form.date}\n            onChange={(e) => setForm({ ...form, date: e.target.value })}\n            className=\"w-full border rounded p-2\"\n          />\n        </div>\n\n        {/* 是否发布 */}\n        <div className=\"flex items-center\">\n          <input\n            type=\"checkbox\"\n            checked={form.published}\n            onChange={(e) => setForm({ ...form, published: e.target.checked })}\n            className=\"mr-2\"\n          />\n          <label>{t('published')}</label>\n        </div>\n\n        {/* 按钮 */}\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            type=\"button\"\n            onClick={() => router.back()}\n            className=\"px-4 py-2 rounded border hover:bg-gray-100\"\n          >\n            {t('cancel')}\n          </button>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className=\"px-4 py-2 rounded bg-blue-600 text-white disabled:opacity-50\"\n          >\n            {loading ? t('saving') : t('save')}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}