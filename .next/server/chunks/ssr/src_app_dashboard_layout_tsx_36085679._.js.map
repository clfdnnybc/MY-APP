{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///Users/57block/my-app/src/app/dashboard/layout.tsx"],"sourcesContent":["\"use client\";\nimport { ReactNode, useState, useEffect } from \"react\";\nimport { useUsername } from \"../UsernameContext\";\nimport { useTransitionRouter } from 'next-view-transitions'\nimport { useTranslation } from \"react-i18next\";\n\ninterface Props {\n  children: ReactNode;\n}\n\nexport default function DashboardLayout({ children }: Props) {\n  const [showLogout, setShowLogout] = useState(false);\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [logoutPos, setLogoutPos] = useState<{ x: number; y: number } | null>(null);\n  const router = useTransitionRouter();\n  const { t, i18n } = useTranslation();\n  const [mounted, setMounted] = useState(false); // 新增\n\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  const handleLogout = () => {\n    setShowLogout(false);\n    setTimeout(() => router.push(\"/login\"), 500);\n  };\n\n  const { username } = useUsername();\n\n  const handleLogoutClick = (e: React.MouseEvent) => {\n    const rect = (e.target as HTMLElement).getBoundingClientRect();\n    if (rect.width === 0 && rect.height === 0) {\n      setLogoutPos({ x: window.innerWidth / 2, y: window.innerHeight / 2 });\n    } else {\n      const x = rect.left + rect.width / 2;\n      const y = rect.top + rect.height / 2;\n      setLogoutPos({ x, y });\n    }\n    setShowLogout(true);\n  };\n\n  type MenuItem = \n    | { label: string; href: string; icon: string; action?: undefined }\n    | { label: string; icon: string; action: (e: React.MouseEvent) => void; href?: undefined };\n\n  // 只在 mounted 后渲染依赖 t 的内容，避免 hydration mismatch\n  if (!mounted) return <div />;\n\n  const menuItems: MenuItem[] = [\n    { label: t(\"dashboard\"), href: \"/dashboard\", icon: \"icon-[mynaui--home]\" },\n    { label: t(\"account\"), href: \"/dashboard/account\", icon: \"icon-[mynaui--user]\" },\n    { label: t(\"settings\"), href: \"/dashboard/settings\", icon: \"icon-[mynaui--cog-four]\" },\n    { label: t(\"logout\"), action: handleLogoutClick, icon: \"icon-[mynaui--logout]\" },\n  ];\n\n  const getPopupStyle = () => {\n    if (!logoutPos) return {};\n    const centerX = window.innerWidth / 2;\n    const centerY = window.innerHeight / 2;\n    const dx = logoutPos.x - centerX;\n    const dy = logoutPos.y - centerY;\n    return {\n      [\"--popup-transform-from\" as any]: `scale(0) translate(${dx}px, ${dy}px)`,\n      animation: \"popup-move-scale 0.4s cubic-bezier(.4,2,.6,1) forwards\",\n    } as React.CSSProperties;\n  };\n\n  return (\n    <div className=\"flex h-screen\">\n      {/* 侧边栏 */}\n      <aside\n        className={`flex flex-col bg-white dark:bg-gray-800 transition-all duration-300  ${\n          sidebarOpen ? \"w-56\" : \"w-0\"\n        }`}\n      >\n        <div className=\"p-4 space-y-2\">\n          {menuItems.map((item) => (\n            <button\n              key={item.label}\n              onClick={\n                item.action\n                  ? (e) => item.action && item.action(e)\n                  : () => item.href && router.push(item.href)\n              }\n              title={item.label}\n              className={`w-full flex items-center px-3 py-2 rounded\n                ${item.label === t('logout')\n                  ? 'bg-red-500 text-white dark:bg-red-600 hover:bg-red-600 dark:hover:bg-red-700'\n                  : 'text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900'\n                }\n                ${!sidebarOpen && 'hidden'}\n              `}\n            >\n              {sidebarOpen && <span className={`w-5 h-5 ${item.icon} dark:color-white`} />}\n              {sidebarOpen && <span className=\"ml-3 text-sm\">{item.label}</span>}\n            </button>\n          ))}\n        </div>\n      </aside>\n\n      {/* 主内容区 */}\n      <div className=\"flex-1 flex flex-col\">\n        {/* Header */}\n        <header className=\"bg-blue-100 dark:bg-gray-700 p-6 h-16 shadow-md flex items-center\">\n          {/* 侧边栏开关按钮 */}\n          <button\n            onClick={() => setSidebarOpen(!sidebarOpen)}\n            className=\"mr-4 p-2 rounded hover:bg-blue-200 dark:hover:bg-gray-600\"\n          >\n            <span className={`w-5 h-5 icon-[mynaui--menu] dark:color-white`} />\n          </button>\n\n          <div className=\"ml-auto relative group\">\n            {/* 头像按钮 */}\n            <button className=\"flex items-center space-x-2 bg-white dark:bg-black p-2 rounded-lg\">\n              <span className=\"text-sm text-gray-600 dark:text-gray-200\">{username}</span>\n              <img src=\"/avatar.ico\" alt=\"avatar\" className=\"w-8 h-8 rounded-full object-cover\" />\n            </button>\n\n            {/* 透明桥接层 */}\n            <div className=\"absolute top-full left-0 right-0 h-2\" />\n\n            {/* 弹窗 */}\n            <div\n              className=\"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50\n                         opacity-0 scale-95 origin-top-right\n                         group-hover:opacity-100 group-hover:scale-100\n                         transition-all duration-200 ease-out\n                         p-4 space-y-3 pointer-events-none group-hover:pointer-events-auto\"\n            >\n              <div className=\"flex items-center space-x-3\">\n                <img src=\"/avatar.ico\" alt=\"avatar\" className=\"w-10 h-10 rounded-full object-cover\" />\n                <span className=\"font-medium text-gray-800 dark:text-gray-200\">{username}</span>\n              </div>\n\n              {/* 弹窗菜单 */}\n              {menuItems.map((item) => (\n                <button\n                  key={item.label}\n                  onClick={\n                    item.action\n                      ? (e) => item.action && item.action(e)\n                      : () => item.href && router.push(item.href)\n                  }\n                  className={`w-full flex items-center px-3 py-2 rounded\n                    ${item.label === t('logout')\n                      ? 'bg-red-500 text-white dark:bg-red-600 hover:bg-red-600 dark:hover:bg-red-700'\n                      : 'text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-900'\n                    }`}\n                >\n                  <span className={`w-4 h-4 mr-2 ${item.icon} dark:color-white`} />\n                  {item.label}\n                </button>\n              ))}\n            </div>\n          </div>\n        </header>\n\n        <main className=\"flex-1 overflow-y-auto p-6\">{children}</main>\n\n        {/* Logout 确认弹窗 */}\n        {showLogout && (\n          <div className=\"fixed inset-0 bg-black/40 z-50\">\n            <div\n              className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-80\"\n              style={{\n                ...getPopupStyle(),\n                position: \"fixed\",\n                left: \"50%\",\n                top: \"50%\",\n              }}\n              key={logoutPos ? `${logoutPos.x},${logoutPos.y}` : \"center\"}\n            >\n              <h2 className=\"text-lg font-semibold mb-4\">{t(\"confirmLogout\")}</h2>\n              <p className=\"text-sm text-gray-600 mb-6\">{t(\"confirmTips\")}</p>\n              <div className=\"flex justify-end space-x-3\">\n                <button onClick={() => setShowLogout(false)} className=\"px-4 py-2 rounded border border-gray-300 hover:bg-gray-100 dark:hover:bg-gray-900\">{t(\"cancel\")}</button>\n                <button onClick={handleLogout} className=\"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700\">{t(\"confirm\")}</button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}